# **Calling Convention for [[Subroutines]]**

As discussed in class, the NIOS II _Subroutine Calling Convention_ provides guidelines (“rules”) for how [[Registers]] should be used in a program, especially when subroutines are involved. It states that a subroutine is allowed to **modify only NIOS II registers r8 to r15**, but it is **not permitted to have changed the contents of NIOS II registers r16 to r23** after execution of the subroutine. If you need to use registers r16 to r23 inside a subroutine, then you must save their current values by pushing them onto the stack at the beginning of the subroutine, and then restore these saved values by popping them off the stack before returning from the subroutine. (Note: if you are using CPUlator, then you will see an error stating that you have “clobbered” one ore more of the registers r16 to r23 if you over-write these registers in a subroutine without saving/restoring their values as required by the calling convention.)

The proper procedures for passing parameters into a subroutine, and returning results, are also specified by the calling convention. It states that **parameters have to be passed to a subroutine using registers r4 to r7**. If you need to transmit more than four parameters into a subroutine, then the extra ones should be passed through the stack, where the caller must both push them onto the stack, and remove them upon return from the callee. Similarly, at most two results can be **returned from a subroutine using register r2 and r3**. If more results need to be returned, then the stack is also used.